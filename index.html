<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdScenes Organiser</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        :root {
            /* --- THEME: "Cupertino Glass" --- */
            --bg-body: #F9FAFB;         
            --bg-surface: #FFFFFF;
            --bg-subtle: #F3F4F6;
            
            --text-primary: #111827;    
            --text-secondary: #6B7280;  
            --text-tertiary: #9CA3AF;   
            
            --brand: #007AFF; 
            --brand-subtle: #EFF6FF;
            
            --border: #E5E7EB;
            
            /* Status Colors */
            --dot-draft: #9CA3AF;   /* Gray */
            --dot-wip: #F59E0B;     /* Amber */
            --dot-ready: #10B981;   /* Green */
            --dot-posted: #3B82F6;  /* Blue */

            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-float: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
            --shadow-modal: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            
            --ease: cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        html { scrollbar-gutter: stable; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-body);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container-width { max-width: 1400px; margin: 0 auto; width: 100%; padding: 0 40px; }

        /* --- HEADER --- */
        .header {
            height: 72px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex; align-items: center;
            position: sticky; top: 0; z-index: 100;
        }

        .header-content { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .logo { font-weight: 700; font-size: 18px; letter-spacing: -0.02em; color: var(--text-primary); cursor: pointer; user-select: none; }
        .logo span { color: var(--text-tertiary); font-weight: 400; }

        .header-right { display: flex; align-items: center; gap: 12px; }

        /* Buttons */
        .btn-icon {
            width: 36px; height: 36px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            color: var(--text-secondary); cursor: pointer; transition: all 0.2s;
            border: 1px solid transparent;
        }
        .btn-icon:hover { background: rgba(0,0,0,0.04); color: var(--text-primary); }

        .btn-primary {
            height: 36px; padding: 0 16px; border-radius: 8px; font-size: 13px; font-weight: 600;
            display: inline-flex; align-items: center; gap: 6px;
            background: var(--text-primary); color: white; border: none; 
            cursor: pointer; transition: all 0.2s var(--ease);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        
        .icon-svg { width: 16px; height: 16px; stroke: currentColor; stroke-width: 2; fill: none; }

        /* --- TOOLBAR --- */
        .main-wrapper { padding-top: 40px; padding-bottom: 80px; flex: 1; }
        .toolbar { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 24px; }
        
        .view-toggle { background: var(--bg-subtle); padding: 3px; border-radius: 10px; display: inline-flex; }
        .toggle-opt {
            padding: 6px 14px; border-radius: 7px; font-size: 12px; font-weight: 600; 
            color: var(--text-secondary); cursor: pointer; border: none; background: transparent; 
            transition: all 0.2s;
        }
        .toggle-opt:hover { color: var(--text-primary); }
        .toggle-opt.active { background: white; color: var(--text-primary); box-shadow: 0 1px 3px rgba(0,0,0,0.05); }

        /* --- VIEWS --- */
        .view-container { display: none; animation: fadeIn 0.4s var(--ease); }
        .view-container.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        /* LIST VIEW */
        .table-frame { background: var(--bg-surface); border-radius: 16px; box-shadow: var(--shadow-sm); border: 1px solid var(--border); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        th { text-align: left; padding: 16px 24px; font-size: 11px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid var(--border); background: #FAFAFA; }
        td { padding: 16px 24px; border-bottom: 1px solid var(--border); font-size: 14px; vertical-align: middle; color: var(--text-secondary); transition: background 0.1s; }
        tr:last-child td { border-bottom: none; }
        tr { transition: background 0.1s; cursor: pointer; }
        tr:hover td { background: #F9FAFB; }
        tr:hover .action-group { opacity: 1; }

        .cell-title { font-weight: 600; color: var(--text-primary); margin-bottom: 4px; }
        .cell-sub { font-size: 12px; color: var(--text-tertiary); }
        .text-truncate { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; }

        .status-badge { 
            display: inline-flex; align-items: center; gap: 6px; 
            padding: 4px 8px; border-radius: 6px; 
            font-size: 12px; font-weight: 500; color: var(--text-primary);
            background: white; border: 1px solid var(--border); transition: all 0.2s;
        }
        .status-badge:hover { border-color: var(--text-tertiary); background: #F9FAFB; }
        .dot { width: 6px; height: 6px; border-radius: 50%; }

        .asset-btn {
            display: inline-flex; align-items: center; gap: 6px;
            font-size: 12px; font-weight: 500; color: var(--brand);
            background: var(--brand-subtle); padding: 6px 12px; border-radius: 20px;
            text-decoration: none; transition: all 0.2s; white-space: nowrap;
        }
        .asset-btn:hover { background: #DBEAFE; }

        .action-group { display: flex; gap: 8px; justify-content: flex-end; opacity: 0; transition: opacity 0.2s; }
        .action-icon { color: var(--text-tertiary); padding: 4px; border-radius: 4px; }
        .action-icon:hover { color: var(--text-primary); background: rgba(0,0,0,0.05); }

        /* CARD VIEW */
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px; }
        .card { 
            background: var(--bg-surface); border-radius: 16px; 
            border: 1px solid var(--border); box-shadow: var(--shadow-sm); 
            transition: all 0.2s var(--ease); cursor: pointer; display: flex; flex-direction: column; overflow: hidden;
        }
        .card:hover { transform: translateY(-4px); box-shadow: var(--shadow-float); }
        
        .card-preview {
            height: 140px; background: var(--bg-subtle); 
            display: flex; align-items: center; justify-content: center;
            color: var(--text-tertiary); font-size: 13px; border-bottom: 1px solid var(--border);
        }
        .card-body { padding: 20px; display:flex; flex-direction:column; gap:12px; flex:1; }
        .card-meta { display: flex; justify-content: space-between; align-items: center; }
        
        /* CALENDAR VIEW */
        .cal-frame { background: var(--bg-surface); border-radius: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm); padding: 24px; }
        .cal-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); width: 100%; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
        .cal-day-label { background: #F8FAFC; padding: 12px; text-align: center; font-size: 11px; font-weight: 700; color: var(--text-tertiary); text-transform: uppercase; border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); }
        .cal-day-label:nth-child(7n) { border-right: none; }
        .cal-cell { background: white; min-height: 140px; padding: 10px; cursor: pointer; border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); transition: background 0.1s; display: flex; flex-direction: column; }
        .cal-cell:nth-child(7n) { border-right: none; }
        .cal-cell:hover { background: #F9FAFB; }
        .cal-num { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; flex-shrink: 0; }
        .cal-cell.today .cal-num { background: var(--brand); color: white; }
        .event-pill { background: var(--brand-subtle); color: var(--brand); padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border-left: 3px solid var(--brand); width: 100%; }

        /* --- MODALS --- */
        .overlay {
            position: fixed; inset: 0; background: rgba(0, 0, 0, 0.2); 
            backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
            z-index: 500; display: none; align-items: center; justify-content: center; 
            opacity: 0; transition: opacity 0.2s;
        }
        .overlay.active { display: flex; opacity: 1; }
        
        .modal {
            background: var(--bg-surface); width: 480px; border-radius: 20px;
            box-shadow: var(--shadow-modal); 
            transform: scale(0.95) translateY(10px); transition: transform 0.3s var(--ease); 
            display: flex; flex-direction: column; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.5);
        }
        .overlay.active .modal { transform: scale(1) translateY(0); }
        .modal-body { padding: 32px 32px 16px 32px; }
        .modal-foot { padding: 24px 32px 32px 32px; display: flex; justify-content: space-between; align-items: center; }

        .field-group { margin-bottom: 20px; position: relative; }
        .input-label { display: block; font-size: 11px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px; }
        .input-box {
            width: 100%; padding: 12px 16px; border-radius: 12px; 
            border: none; background: var(--bg-subtle);
            font-family: inherit; font-size: 14px; color: var(--text-primary); 
            transition: all 0.2s;
        }
        .input-box:focus { background: white; box-shadow: 0 0 0 2px var(--brand); outline: none; }
        .row { display: flex; gap: 16px; }
        .col { flex: 1; }

        /* CUSTOM DATE PICKER STYLES */
        .date-picker-dropdown {
            position: absolute; top: calc(100% + 8px); left: 0;
            background: white; border: 1px solid var(--border);
            border-radius: 16px; box-shadow: var(--shadow-float);
            padding: 16px; width: 280px; z-index: 600; display: none;
        }
        .dp-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .dp-btn { background: none; border: none; cursor: pointer; color: var(--text-secondary); padding: 4px; border-radius: 4px; }
        .dp-btn:hover { background: var(--bg-subtle); color: var(--text-primary); }
        .dp-title { font-weight: 600; font-size: 14px; }
        .dp-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .dp-day-head { font-size: 10px; text-align: center; color: var(--text-tertiary); font-weight: 700; margin-bottom: 4px; }
        .dp-day { 
            height: 32px; display: flex; align-items: center; justify-content: center; 
            font-size: 13px; border-radius: 8px; cursor: pointer; color: var(--text-primary);
        }
        .dp-day:hover { background: var(--bg-subtle); }
        .dp-day.selected { background: var(--brand); color: white; }
        .dp-day.empty { pointer-events: none; }

        /* DROPDOWNS */
        .dropdown-menu {
            position: absolute; top: calc(100% + 8px); right: 0;
            background: var(--bg-surface); border: 1px solid var(--border);
            border-radius: 12px; box-shadow: var(--shadow-float);
            min-width: 200px; padding: 6px; display: none; z-index: 200;
        }
        .empty-state { text-align: center; padding: 80px 0; color: var(--text-tertiary); }
        .toast {
            position: fixed; bottom: 32px; left: 50%; transform: translate(-50%, 20px);
            background: var(--text-primary); color: white; padding: 10px 20px; border-radius: 50px;
            font-size: 13px; font-weight: 500; opacity: 0; pointer-events: none; 
            box-shadow: var(--shadow-float); transition: all 0.3s var(--ease); z-index: 1000;
        }
        .toast.show { opacity: 1; transform: translate(-50%, 0); }
        .hidden { display: none; }
        .text-btn { background: none; border: none; color: var(--text-secondary); font-weight: 500; font-size: 13px; cursor: pointer; }
        .text-btn:hover { color: var(--text-primary); }
        .danger { color: #EF4444; } .danger:hover { color: #DC2626; }

    </style>
</head>
<body>

    <header class="header">
        <div class="container-width header-content">
            <div class="logo" onclick="window.location.reload()">
                adscenes <span>organiser</span>
            </div>
            
            <div class="header-right">
                <div style="position: relative;">
                    <div class="btn-icon" id="clientBtn" onclick="toggleDrop(event, 'clientDrop')">
                        <svg class="icon-svg" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    </div>
                    <div class="dropdown-menu" id="clientDrop"></div>
                </div>

                <div style="position: relative;">
                    <div class="btn-icon" onclick="toggleDrop(event, 'menuDrop')">
                        <svg class="icon-svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg>
                    </div>
                    <div class="dropdown-menu" id="menuDrop">
                        <div style="padding:10px; font-size:13px; cursor:pointer;" onclick="imp()">Import JSON</div>
                        <div style="padding:10px; font-size:13px; cursor:pointer;" onclick="exp()">Export JSON</div>
                        <div style="height:1px; background:var(--border); margin:4px 0;"></div>
                        <div class="danger" style="padding:10px; font-size:13px; cursor:pointer;" onclick="wipe()">Clear Data</div>
                    </div>
                </div>

                <button class="btn-primary" onclick="openModal()">
                    <svg class="icon-svg" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    <span>Create</span>
                </button>
            </div>
        </div>
    </header>

    <main class="main-wrapper">
        <div class="container-width">
            
            <div class="toolbar">
                <div>
                    <h1 style="font-size: 24px; font-weight: 700; color: var(--text-primary); letter-spacing: -0.03em;">Campaigns</h1>
                    <div style="font-size: 13px; color: var(--text-tertiary); margin-top: 4px;" id="subtitle">All posts for all clients</div>
                </div>
                
                <div class="view-toggle">
                    <button class="toggle-opt active" onclick="setView('table', this)">List</button>
                    <button class="toggle-opt" onclick="setView('card', this)">Cards</button>
                    <button class="toggle-opt" onclick="setView('calendar', this)">Calendar</button>
                </div>
            </div>

            <div id="v-table" class="view-container active">
                <div class="table-frame">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 40%;">Content</th>
                                <th style="width: 15%;">Status</th>
                                <th style="width: 15%;">Client</th>
                                <th style="width: 15%;">Asset</th>
                                <th style="width: 15%; text-align:right;">Date</th>
                            </tr>
                        </thead>
                        <tbody id="tbody"></tbody>
                    </table>
                </div>
            </div>

            <div id="v-card" class="view-container">
                <div class="card-grid" id="cardgrid"></div>
            </div>

            <div id="v-calendar" class="view-container">
                <div class="cal-frame">
                    <div class="cal-head">
                        <h2 id="calTitle" style="font-size: 18px; font-weight: 700;">Month</h2>
                        <div style="display: flex; gap: 8px;">
                            <button class="text-btn" onclick="movMonth(-1)">Prev</button>
                            <button class="text-btn" onclick="currMonth()">Today</button>
                            <button class="text-btn" onclick="movMonth(1)">Next</button>
                        </div>
                    </div>
                    <div class="cal-grid" id="calgrid"></div>
                </div>
            </div>

        </div>
    </main>

    <div class="overlay" id="postModal">
        <div class="modal">
            <div class="modal-body">
                <form id="form" onsubmit="save(event)">
                    <div class="field-group">
                        <label class="input-label">Title</label>
                        <input type="text" id="inpTitle" class="input-box" placeholder="Campaign Name" required autofocus>
                    </div>
                    <div class="row">
                        <div class="col field-group">
                            <label class="input-label">Client</label>
                            <select id="inpClient" class="input-box" style="-webkit-appearance: none; cursor:pointer;"></select>
                        </div>
                        <div class="col field-group">
                            <label class="input-label">Schedule Date</label>
                            <input type="text" id="inpDateDisplay" class="input-box" placeholder="Select Date" readonly style="cursor: pointer;" onclick="toggleDatePicker(event)">
                            <input type="hidden" id="inpDate" required>
                            <div class="date-picker-dropdown" id="datePicker" onclick="event.stopPropagation()">
                                <div class="dp-header">
                                    <button type="button" class="dp-btn" onclick="dpMonth(-1)">←</button>
                                    <span class="dp-title" id="dpTitle">Month Year</span>
                                    <button type="button" class="dp-btn" onclick="dpMonth(1)">→</button>
                                </div>
                                <div class="dp-grid">
                                    <div class="dp-day-head">S</div><div class="dp-day-head">M</div><div class="dp-day-head">T</div><div class="dp-day-head">W</div><div class="dp-day-head">T</div><div class="dp-day-head">F</div><div class="dp-day-head">S</div>
                                </div>
                                <div class="dp-grid" id="dpGrid"></div>
                            </div>
                        </div>
                    </div>
                    <div class="field-group">
                        <label class="input-label">Drive Asset Link</label>
                        <input type="url" id="inpLink" class="input-box" placeholder="https://drive.google.com/...">
                    </div>
                    <div class="field-group">
                        <div style="display:flex; justify-content:space-between;">
                            <label class="input-label">Caption</label>
                            <span id="charCount" style="font-size:11px; color:var(--text-tertiary);">0</span>
                        </div>
                        <textarea id="inpCaption" class="input-box" rows="4" placeholder="Write your post..." oninput="updateCount()"></textarea>
                    </div>
                    <div class="field-group">
                        <label class="input-label">Alt Text</label>
                        <input type="text" id="inpAlt" class="input-box" placeholder="Image description">
                    </div>
                    <input type="hidden" id="inpStatus" value="Draft">
                </form>
            </div>
            <div class="modal-foot">
                <button class="text-btn danger" id="btnDel" style="display:none;" onclick="delPost()">Delete</button>
                <div style="flex:1;"></div>
                <button class="text-btn" style="margin-right: 16px;" onclick="closeModal()">Cancel</button>
                <button class="btn-primary" onclick="document.getElementById('form').requestSubmit()">Save Post</button>
            </div>
        </div>
    </div>

    <div class="overlay" id="cliModal">
        <div class="modal">
            <div class="modal-body">
                <h3 style="font-size:16px; font-weight:600; margin-bottom:16px;">Manage Clients</h3>
                <div style="display: flex; gap: 8px; margin-bottom: 24px;">
                    <input type="text" id="newCliName" class="input-box" placeholder="New Client Name">
                    <button class="btn-primary" onclick="addCli()">Add</button>
                </div>
                <div style="max-height: 300px; overflow-y:auto; border-top:1px solid var(--border);">
                    <div id="cliList"></div>
                </div>
            </div>
            <div class="modal-foot">
                <div style="flex:1"></div>
                <button class="text-btn" onclick="closeModal()">Done</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">Changes Saved</div>
    <input type="file" id="file" hidden accept=".json" onchange="readFile(event)">

    <script>
        // --- DATA LAYER ---
        const KEYS = { POSTS: 'adscenes_master_posts', CLIENTS: 'adscenes_master_clients' };
        let posts = [], clients = [], filter = 'All Clients';
        let editId = null;
        let cDate = new Date(); // Main Cal
        let pickerDate = new Date(); // Picker Cal

        // Legacy Keys for Migration
        const LEGACY = ['as_posts_v9','as_posts_v8','as_posts_v7','as_posts_v6','as_posts_v5'];

        window.onload = () => {
            // Load & Migrate
            let pData = localStorage.getItem(KEYS.POSTS);
            let cData = localStorage.getItem(KEYS.CLIENTS);
            if(!pData) { LEGACY.forEach(k => { let d=localStorage.getItem(k); if(d && d!=='[]') pData=d; }); }
            if(pData) posts = JSON.parse(pData);
            if(cData) clients = JSON.parse(cData);
            
            // Cleanup
            posts = posts.map(p => ({...p, status: p.status || 'Draft'}));
            render();
            
            // Global Click
            document.onclick = (e) => {
                if(!e.target.closest('.header-right')) document.querySelectorAll('.dropdown-menu').forEach(d => d.style.display='none');
                if(!e.target.closest('#inpDateDisplay') && !e.target.closest('#datePicker')) document.getElementById('datePicker').style.display='none';
            };
        };

        function persist() {
            localStorage.setItem(KEYS.POSTS, JSON.stringify(posts));
            localStorage.setItem(KEYS.CLIENTS, JSON.stringify(clients));
            render();
        }

        // --- RENDER ENGINE ---
        function render() {
            const visible = filter === 'All Clients' ? posts : posts.filter(p => p.client === filter);
            
            document.getElementById('subtitle').textContent = filter === 'All Clients' ? `${posts.length} posts total` : `${visible.length} posts for ${filter}`;

            // 1. List View
            const tbody = document.getElementById('tbody');
            if(visible.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="empty-state">No posts found.</td></tr>`;
            } else {
                tbody.innerHTML = visible.map(p => {
                    const dot = p.status === 'Ready' ? 'var(--dot-ready)' : (p.status === 'Posted' ? 'var(--dot-posted)' : (p.status === 'WIP' ? 'var(--dot-wip)' : 'var(--dot-draft)'));
                    const statTxt = p.status === 'WIP' ? 'In Progress' : p.status;
                    return `
                    <tr onclick="edit('${p.id}')">
                        <td>
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <div>
                                    <div class="cell-title text-truncate" style="max-width:320px;">${esc(p.title)}</div>
                                    <div class="cell-sub text-truncate" style="max-width:320px;">${esc(p.caption) || 'No caption'}</div>
                                </div>
                                <div class="action-group">
                                    <div class="action-icon" onclick="copy(event, '${esc(p.caption)}')" title="Copy Caption"><svg class="icon-svg" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="status-badge" onclick="cycleStatus(event, '${p.id}')">
                                <div class="dot" style="background:${dot}"></div>
                                ${statTxt}
                            </div>
                        </td>
                        <td><span style="font-weight:500; font-size:13px;">${esc(p.client)}</span></td>
                        <td>${p.link ? `<a href="${p.link}" target="_blank" onclick="event.stopPropagation()" class="asset-btn"><svg class="icon-svg" viewBox="0 0 24 24"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>Asset</a>` : '<span style="color:var(--text-tertiary); font-size:12px;">—</span>'}</td>
                        <td style="text-align:right; font-variant-numeric: tabular-nums;">${formatDate(p.date)}</td>
                    </tr>
                `}).join('');
            }

            // 2. Card View
            const cgrid = document.getElementById('cardgrid');
            cgrid.innerHTML = visible.map(p => {
                const dot = p.status === 'Ready' ? 'var(--dot-ready)' : (p.status === 'Posted' ? 'var(--dot-posted)' : (p.status === 'WIP' ? 'var(--dot-wip)' : 'var(--dot-draft)'));
                 const statTxt = p.status === 'WIP' ? 'In Progress' : p.status;
                return `
                <div class="card" onclick="edit('${p.id}')">
                    <div class="card-preview">
                        ${p.link ? '<svg class="icon-svg" style="width:32px; height:32px; opacity:0.5;" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>' : 'No Asset'}
                    </div>
                    <div class="card-body">
                        <div class="card-meta">
                            <span class="status-badge" style="font-size:11px; padding:2px 6px;"><div class="dot" style="background:${dot}; width:5px; height:5px;"></div>${statTxt}</span>
                            <span style="font-size:11px; color:var(--text-tertiary);">${formatDate(p.date)}</span>
                        </div>
                        <div class="cell-title text-truncate">${esc(p.title)}</div>
                        <div class="cell-sub text-truncate">${esc(p.caption)}</div>
                    </div>
                </div>
            `}).join('');

            // 3. Calendar View
            renderCal(visible);

            // 4. Client Drop
            const cliDrop = document.getElementById('clientDrop');
            cliDrop.innerHTML = `
                <div style="padding:10px; font-size:13px; font-weight:600; cursor:pointer; color:var(--brand);" onclick="setFilter('All Clients')">All Clients</div>
                <div style="height:1px; background:var(--border); margin:4px 0;"></div>
                ${clients.map(c => `<div style="padding:8px 10px; font-size:13px; cursor:pointer;" onclick="setFilter('${c}')">${c}</div>`).join('')}
                <div style="height:1px; background:var(--border); margin:4px 0;"></div>
                <div style="padding:10px; font-size:12px; cursor:pointer; color:var(--text-secondary);" onclick="openCliManager()">Manage Clients...</div>
            `;
        }

        // --- CALENDAR LOGIC ---
        function renderCal(list) {
            const mNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            document.getElementById('calTitle').textContent = `${mNames[cDate.getMonth()]} ${cDate.getFullYear()}`;
            const grid = document.getElementById('calgrid');
            const y = cDate.getFullYear(), m = cDate.getMonth();
            const firstDay = new Date(y, m, 1).getDay();
            const daysInM = new Date(y, m + 1, 0).getDate();
            const today = new Date().toISOString().split('T')[0];
            
            let html = `<div class="cal-day-label">Sun</div><div class="cal-day-label">Mon</div><div class="cal-day-label">Tue</div><div class="cal-day-label">Wed</div><div class="cal-day-label">Thu</div><div class="cal-day-label">Fri</div><div class="cal-day-label">Sat</div>`;
            for(let i=0; i<firstDay; i++) html += `<div class="cal-cell" style="background:#F8FAFC"></div>`;
            for(let d=1; d<=daysInM; d++) {
                const dateStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const isToday = dateStr === today;
                const pList = list.filter(p => p.date === dateStr);
                html += `<div class="cal-cell ${isToday?'today':''}" onclick="openModal('${dateStr}')"><div class="cal-num">${d}</div>${pList.map(p => `<div class="event-pill" onclick="event.stopPropagation(); edit('${p.id}')">${esc(p.title)}</div>`).join('')}</div>`;
            }
            grid.innerHTML = html;
        }

        // --- ACTIONS ---
        function openModal(dateStr = null) {
            editId = null; document.getElementById('form').reset(); document.getElementById('btnDel').style.display = 'none';
            const sel = document.getElementById('inpClient'); sel.innerHTML = clients.map(c => `<option>${c}</option>`).join('');
            if(filter !== 'All Clients') sel.value = filter;
            
            // Set Date
            const ds = dateStr || new Date().toISOString().split('T')[0];
            document.getElementById('inpDate').value = ds;
            document.getElementById('inpDateDisplay').value = formatDate(ds);
            
            document.getElementById('postModal').classList.add('active');
            updateCount();
        }

        function edit(id) {
            const p = posts.find(x => x.id === id); if(!p) return; editId = id;
            const sel = document.getElementById('inpClient'); sel.innerHTML = clients.map(c => `<option>${c}</option>`).join('');
            sel.value = p.client;
            document.getElementById('inpTitle').value = p.title;
            
            document.getElementById('inpDate').value = p.date;
            document.getElementById('inpDateDisplay').value = formatDate(p.date);
            
            document.getElementById('inpLink').value = p.link || '';
            document.getElementById('inpCaption').value = p.caption;
            document.getElementById('inpAlt').value = p.alt || '';
            document.getElementById('inpStatus').value = p.status;
            document.getElementById('btnDel').style.display = 'block';
            document.getElementById('postModal').classList.add('active');
            updateCount();
        }

        function save(e) {
            e.preventDefault();
            const p = {
                id: editId || 'post_' + Date.now(),
                title: document.getElementById('inpTitle').value,
                client: document.getElementById('inpClient').value,
                date: document.getElementById('inpDate').value,
                link: document.getElementById('inpLink').value,
                caption: document.getElementById('inpCaption').value,
                alt: document.getElementById('inpAlt').value,
                status: document.getElementById('inpStatus').value || 'Draft'
            };
            if(editId) { posts[posts.findIndex(x=>x.id===editId)] = p; toast('Post Updated'); } 
            else { posts.push(p); toast('Post Created'); }
            closeModal(); persist();
        }
